<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>phy++ API</title>
    <link rel="stylesheet" href="pygments.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>

  <div class="header">
  <i>phy</i><sub>++</sub> <span class="header-text">documentation</span>
  </div>

  <div class="page">
  <script src="menu-left.js"></script>
  <script src="menu-right.js"></script>

<div class="content">
<span class="section">Categories</span><br>
<div class="catlist">
<a href="category_support_08_time.html">Measuring time</a>
</div><br>
<span class="section">Signatures</span>
<table style="signatures">
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">now</span><span class="p">()</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">profile</span><span class="p">(</span><span class="n">F</span> <span class="n">func</span><span class="p">)</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">profile</span><span class="p">(</span><span class="n">F</span> <span class="n">func</span><span class="p">,</span> <span class="kt">uin_t</span> <span class="n">n</span><span class="p">)</span>
</pre></div></td></tr>
</table>
<br><span class="section">Description</span><br>
<div class="description">
The function <div class="highlight-inline"><pre><span class="n">now</span><span class="p">()</span></pre></div> returns the current time, in seconds, with microsecond resolution (or better). The reference point (i.e., the precise moment when <div class="highlight-inline"><pre><span class="n">now</span><span class="p">()</span></pre></div> returned zero) is unspecified. Therefore, <div class="highlight-inline"><pre><span class="n">now</span><span class="p">()</span></pre></div> is only meant to be used for measuring the time elapsed between two calls, for example to time the execution of a given piece of code.
<br><br><span class="example">Example</span><br><hr>
<div class="highlight"><pre><span class="kt">double</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span>
<span class="n">vec1d</span> <span class="n">v</span> <span class="o">=</span> <span class="n">dindgen</span><span class="p">(</span><span class="mf">1e8</span><span class="p">);</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">sqr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mf">3.5</span><span class="p">));</span>
<span class="kt">double</span> <span class="n">end</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span>

<span class="c1">// How fast can you go?</span>
<span class="c1">// Warning if you try this at home: the above cove needs a lot of RAM</span>
<span class="c1">// memory to run (about 4 GB on my machine).</span>
<span class="n">print</span><span class="p">(</span><span class="s">&quot;total time: &quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">);</span>
<span class="c1">// On my computer:</span>
<span class="c1">// total time: 15.8251</span>
</pre></div>
<hr><br>
The function <div class="highlight-inline"><pre><span class="n">profile</span><span class="p">()</span></pre></div> is just a shortcut that simplifies writing the above example. The code that must be timed is to be provided as the first argument of the function through a C++ lambda (<div class="highlight-inline"><pre><span class="n">func</span></pre></div>). An additional parameter <div class="highlight-inline"><pre><span class="n">n</span></pre></div> will control how many times this piece of code must be executed. Indeed, sometimes the code is so fast that it takes less than a microsecond to run, and therefore <div class="highlight-inline"><pre><span class="n">now</span><span class="p">()</span></pre></div> doesn't have the resolution to properly quantify the execution time. To solve this, the code can be run multiple times to ensure that the execution time goes above one microsecond. This is of course to be reserved for profiling and optimizing purposes, not for production code.
<br><br><span class="example">Example</span><br><hr>
<div class="highlight"><pre><span class="kt">double</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">profile</span><span class="p">([]()</span> <span class="p">{</span>
    <span class="n">vec1d</span> <span class="n">v</span> <span class="o">=</span> <span class="n">dindgen</span><span class="p">(</span><span class="mf">1e8</span><span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">sqr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">log10</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mf">3.5</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// How fast can you go?</span>
<span class="n">print</span><span class="p">(</span><span class="s">&quot;total time: &quot;</span><span class="p">,</span> <span class="n">duration</span><span class="p">);</span>
</pre></div>
<hr><br>
See also <div class="highlight-inline"><pre><span class="n">time_str</span><span class="p">()</span></pre></div> and <div class="highlight-inline"><pre><span class="n">seconds_str</span><span class="p">()</span></pre></div> for a pretty printing of such durations.
</div>
</div>
  </div>
  </body>
</html>

