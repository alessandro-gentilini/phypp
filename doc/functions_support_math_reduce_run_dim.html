<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>phy++ API</title>
    <link rel="stylesheet" href="pygments.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>

  <div class="header">
  <i>phy</i><sub>++</sub> <span class="header-text">documentation</span>
  </div>

  <div class="page">
  <script src="menu-left.js"></script>
  <script src="menu-right.js"></script>

<div class="content">
<span class="section">Categories</span><br>
<div class="catlist">
<a href="category_support_09_math.html">Mathematics</a><span class="catsep">&gt;</span><a href="category_support_09_math.html#SEC_support_math_reduce">Reduction</a>
</div><br>
<span class="section">Signature</span>
<table style="signatures">
<tr><td><div class="highlight-sig"><pre><span class="kt">void</span> <span class="n">run_dim</span><span class="p">(</span><span class="kt">uint_t</span> <span class="n">d</span><span class="p">,</span> <span class="n">vec</span><span class="p">...,</span> <span class="n">F</span> <span class="n">f</span><span class="p">)</span>
</pre></div></td></tr>
</table>
<br><span class="section">Description</span><br>
<div class="description">
<br><br><span class="advanced-title">Advanced</span><div class="advanced"><hr>
This is a meta function. It applies the function <div class="highlight-inline"><pre><span class="n">f</span></pre></div> on slices of the <div class="highlight-inline"><pre><span class="n">n</span></pre></div> vectors (the <div class="highlight-inline"><pre><span class="n">vec</span><span class="p">...</span></pre></div> in the signature) along their <div class="highlight-inline"><pre><span class="n">d</span></pre></div>th dimension. These <div class="highlight-inline"><pre><span class="n">n</span></pre></div> vectors must have exactly the same size and dimensions. The function <div class="highlight-inline"><pre><span class="n">f</span></pre></div> must take <div class="highlight-inline"><pre><span class="n">n</span></pre></div> monodimensional vectors in input. Any return value will be ignored.
<br><br>
This is a more generic version of <div class="highlight-inline"><pre><span class="n">reduce</span><span class="p">()</span></pre></div>. Contrary to <div class="highlight-inline"><pre><span class="n">reduce</span><span class="p">()</span></pre></div>, <div class="highlight-inline"><pre><span class="n">run_dim</span><span class="p">()</span></pre></div> does not return anything. If you want to use the data to create and fill one or several vectors, you have to do this yourself by capturing the output vectors into the lambda function (see the example below). This gives more freedom, for example to output multiple vectors. On top of this, <div class="highlight-inline"><pre><span class="n">run_dim</span><span class="p">()</span></pre></div> allows you to operate on multiple input vectors at the same time.
<br><br><span class="example">Example</span><br><hr>
<div class="highlight"><pre><span class="c1">// We create two 8 x 100 x 5 vectors</span>
<span class="n">vec3d</span> <span class="n">v</span> <span class="o">=</span> <span class="n">dindgen</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="n">vec3d</span> <span class="n">w</span> <span class="o">=</span> <span class="n">dindgen</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="c1">// For each set of 100 values in both vectors, we want to</span>
<span class="c1">// compute the average of these values in &#39;v&#39; weighted by the</span>
<span class="c1">// values in &#39;w&#39;, as well as store the sum of the weights.</span>
<span class="c1">// In other words:</span>
<span class="n">vec2d</span> <span class="nf">m</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">vec2d</span> <span class="nf">s</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">uint_t</span> <span class="n">i</span> <span class="o">:</span> <span class="n">range</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">uint_t</span> <span class="n">j</span> <span class="o">:</span> <span class="n">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// First sum the weights</span>
    <span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">j</span><span class="p">));</span>
    <span class="c1">// Then compute the average, normalized by the sum</span>
    <span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">/</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The function run_dim() can be used to write this without an</span>
<span class="c1">// explicit loop, and will likely result in faster code</span>
<span class="n">run_dim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">uint_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">vec1d</span> <span class="n">xv</span><span class="p">,</span> <span class="n">vec1d</span> <span class="n">xw</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">xw</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">(</span><span class="n">xv</span><span class="o">*</span><span class="n">xw</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">});</span>
</pre></div>
<hr><br>
<hr></div><br>
</div>
</div>
  </div>
  </body>
</html>

