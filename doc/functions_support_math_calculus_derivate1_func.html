<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>phy++ API</title>
    <link rel="stylesheet" href="pygments.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>

  <div class="header">
  <i>phy</i><sub>++</sub> <span class="header-text">documentation</span>
  </div>

  <div class="page">
  <script src="menu-left.js"></script>
  <script src="menu-right.js"></script>

<div class="content">
<span class="section">Categories</span><br>
<div class="catlist">
<a href="category_support_09_math.html">Mathematics</a><span class="catsep">&gt;</span><a href="category_support_09_math.html#SEC_support_math_calculus">Calculus</a>
</div><br>
<span class="section">Signatures</span>
<table style="signatures">
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="n">vec1d</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e</span><span class="p">,</span> <span class="kt">uint_t</span> <span class="n">i</span><span class="p">)</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">derivate2_func</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">derivate2_func</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="n">vec1d</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e</span><span class="p">,</span> <span class="kt">uint_t</span> <span class="n">i</span><span class="p">)</span>
</pre></div></td></tr>
<tr><td><div class="highlight-sig"><pre><span class="kt">double</span> <span class="n">derivate2_func</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="n">vec1d</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e</span><span class="p">,</span> <span class="kt">uint_t</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span>
</pre></div></td></tr>
</table>
<br><span class="section">Description</span><br>
<div class="description">
The <div class="highlight-inline"><pre><span class="n">derivate1_func</span></pre></div> functions compute a numerical approximation of the first derivative of a function <div class="highlight-inline"><pre><span class="n">f</span></pre></div> at point <div class="highlight-inline"><pre><span class="n">x</span></pre></div>, with step <div class="highlight-inline"><pre><span class="n">e</span></pre></div>. To do so, the algorithm uses a <img class="latex" style="vertical-align: -0pt" src="latex/functions_support_math_calculus_0.svg"> point symmetric sampling of the function around <div class="highlight-inline"><pre><span class="n">x</span></pre></div>, ranging from <div class="highlight-inline"><pre><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">)</span></pre></div> to <div class="highlight-inline"><pre><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">)</span></pre></div>, and assumes that <div class="highlight-inline"><pre><span class="n">f</span></pre></div> is continuous and can be well approximated by a <img class="latex" style="vertical-align: -0pt" src="latex/functions_support_math_calculus_1.svg"> order polynomial within this range (the result will be exact if <div class="highlight-inline"><pre><span class="n">f</span></pre></div> <span class="emphasis">is</span> a polynomial of order less or equal to <img class="latex" style="vertical-align: -0pt" src="latex/functions_support_math_calculus_2.svg">).
<br><br>
The first version assumes that <div class="highlight-inline"><pre><span class="n">f</span></pre></div> has a single scalar argument and returns <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_3.svg">, while the second version assumes that <div class="highlight-inline"><pre><span class="n">f</span></pre></div> has a single vector argument <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_4.svg">, in which case the index <div class="highlight-inline"><pre><span class="n">i</span></pre></div> is used to choose with respect to which of the vector's element the partial derivative should be taken, so the function returns <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_5.svg">.
<br><br>
The <div class="highlight-inline"><pre><span class="n">derivate2_func</span></pre></div> functions approximate instead the second derivative of <div class="highlight-inline"><pre><span class="n">f</span></pre></div>. The first version assumes that <div class="highlight-inline"><pre><span class="n">f</span></pre></div> has a single scalar argument and returns <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_6.svg">, while the second version assumes that <div class="highlight-inline"><pre><span class="n">f</span></pre></div> has a single vector argument <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_4.svg">, in which case the index <div class="highlight-inline"><pre><span class="n">i</span></pre></div> is used to choose with respect to which of the vector's element the partial second derivative should be taken, so the function returns <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_7.svg">. The third version computes the partial first derivatives with respect to elements <div class="highlight-inline"><pre><span class="n">i1</span></pre></div> and <div class="highlight-inline"><pre><span class="n">i2</span></pre></div>, so the function returns <img class="latex" style="vertical-align: -3pt" src="latex/functions_support_math_calculus_8.svg">.
<br><br>
The value of <div class="highlight-inline"><pre><span class="n">e</span></pre></div> should be as small as possible, while preserving the fact that <div class="highlight-inline"><pre><span class="n">x</span><span class="o">+</span><span class="n">e</span></pre></div> and <div class="highlight-inline"><pre><span class="n">x</span></pre></div> are different numbers within the accuracy of <div class="highlight-inline"><pre><span class="kt">double</span></pre></div>, as well as <div class="highlight-inline"><pre><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">e</span><span class="p">)</span></pre></div> and <div class="highlight-inline"><pre><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div> if the analytic form of <div class="highlight-inline"><pre><span class="n">f</span></pre></div> would indeed predict that these are two different numbers.
<br><br><span class="example">Example</span><br><hr>
<div class="highlight"><pre><span class="c1">// A simple function</span>
<span class="k">auto</span> <span class="n">f1</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Estimate the derivative at x = pi</span>
<span class="kt">double</span> <span class="n">df</span><span class="p">;</span>
<span class="c1">// The analytic value is</span>
<span class="n">df</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">dpi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dpi</span><span class="o">*</span><span class="n">dpi</span><span class="p">);</span>
<span class="n">df</span><span class="p">;</span> <span class="c1">// 2.70366</span>
<span class="c1">// First try with a poor precision</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">);</span>
<span class="n">df</span><span class="p">;</span> <span class="c1">// 2.70416, error of order 0.001</span>
<span class="c1">// And a little bit better</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">);</span>
<span class="n">df</span><span class="p">;</span> <span class="c1">// 2.70366, good enough</span>

<span class="c1">// We can also work with multiple arguments</span>
<span class="k">auto</span> <span class="n">f2</span> <span class="o">=</span> <span class="p">[](</span><span class="n">vec1d</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">};</span>

<span class="c1">// Estimate the derivative with respect to x[0] at x = {pi, pi}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="p">{</span><span class="n">dpi</span><span class="p">,</span> <span class="n">dpi</span><span class="p">},</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">// Estimate the derivative with respect to x[1] at x = {pi, pi}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">derivate1_func</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="p">{</span><span class="n">dpi</span><span class="p">,</span> <span class="n">dpi</span><span class="p">},</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
<hr><br>
</div>
</div>
  </div>
  </body>
</html>

