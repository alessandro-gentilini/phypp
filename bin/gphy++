#! /bin/bash

if [ -f $1 ]; then
    if [ $1 -ot $1.cpp ]; then
        echo phy++: re-compiling \'$1\'...
        RECOMPILE=1
    else
        RECOMPILE=0
        for f in ${PHYPP_PATH}/include/*
        do
            if [ -f $f ] && [ "$f" -nt $1 ]; then
                echo $f is more recent than program, re-compiling \'$1\'...
                RECOMPILE=1
                break
            fi
        done
        if [ $RECOMPILE -eq 0 ]; then
            for f in ${PHYPP_PATH}/lib/*
            do
                if [ -f $f ] && [ "$f" -nt $1 ]; then
                    echo $f is more recent than program, re-compiling \'$1\'...
                    RECOMPILE=1
                    break
                fi
            done
        fi
    fi
else
    echo phy++: compiling \'$1\'...
    RECOMPILE=1
fi

if [ $RECOMPILE -eq 1 ]; then
    cphy++ time debug $1.cpp
    if [ $? -ne 0 ]; then
        exit
    fi
fi

# TODO: http://stackoverflow.com/questions/1805840/arrow-key-via-stdin
# Start the debugger and run the program
a=./$1
echo phy++: starting debugger...
shift
(echo "run " $@; cat) | gdb ./$a
